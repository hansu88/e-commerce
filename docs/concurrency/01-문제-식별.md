# 01. λ™μ‹μ„± λ¬Έμ  μ‹λ³„

---
### 1. μΏ ν° μ„ μ°©μ λ°κΈ‰ ποΈ


**μ‹λ‚λ¦¬μ¤:**
- μΏ ν° 100κ° λ‚¨μ
- 200λ…μ΄ λ™μ‹μ— "λ°κΈ‰" λ²„νΌ ν΄λ¦­

**λ¬Έμ  μ½”λ“ (λ™μ‹μ„± μ μ–΄ μ—†λ‹¤λ©΄):**
```java
public UserCoupon execute(IssueCouponCommand command) {
    Coupon coupon = couponRepository.findById(couponId).orElseThrow();

    // π¨ λ¬Έμ  μ§€μ !
    if (coupon.getIssuedQuantity() >= coupon.getTotalQuantity()) {
        throw new IllegalStateException("μΏ ν° μ†μ§„");
    }

    coupon.increaseIssuedQuantity();  // issuedQuantity++
    couponRepository.save(coupon);
}
```

**μ™ λ¬Έμ ?**
```
μ‚¬μ©μ A: issuedQuantity = 99 μ½μ β†’ λ°κΈ‰ κ°€λ¥ β…
μ‚¬μ©μ B: issuedQuantity = 99 μ½μ β†’ λ°κΈ‰ κ°€λ¥ β… (Aκ°€ μ €μ¥ μ „!)

μ‚¬μ©μ A: issuedQuantity = 100 μ €μ¥
μ‚¬μ©μ B: issuedQuantity = 100 μ €μ¥ (λ®μ–΄μ”€!)

κ²°κ³Ό: 101λ²μ§Έ μ‚¬μ©μλ„ λ°κΈ‰ κ°€λ¥ (μ΄κ³Ό λ°κΈ‰!)
```

**λ°μƒ ν™•λ¥ :** 
- μ„ μ°©μ μ΄λ²¤νΈλ” λ™μ‹ μ ‘μ† ν­λ°μ  μ¦κ°€
- μ: "μ¤νƒ€λ²…μ¤ λ¬΄λ£ μΏ ν° 100κ°" β†’ 10,000λ… λ™μ‹ μ ‘μ†

---

### 2. μ¬κ³  λ™μ‹ μ°¨κ° π“¦

**νμΌ:** `DecreaseStockUseCase.java`

**μ‹λ‚λ¦¬μ¤:**
- μƒν’ μµμ… μ¬κ³  10κ°
- 20λ…μ΄ λ™μ‹μ— 1κ°μ”© μ£Όλ¬Έ

**λ¬Έμ  μ½”λ“:**
```java
public void execute(DecreaseStockCommand command) {
    ProductOption option = productOptionRepository.findById(optionId).orElseThrow();

    // π¨ λ¬Έμ  μ§€μ !
    if (option.getStock() < quantity) {
        throw new IllegalStateException("μ¬κ³  λ¶€μ΅±");
    }

    option.decreaseStock(quantity);  // stock -= quantity
    productOptionRepository.save(option);
}
```

**μ™ λ¬Έμ ?**
```
μ‚¬μ©μ A: stock = 10 μ½μ β†’ 1κ° μ°¨κ° κ°€λ¥ β…
μ‚¬μ©μ B: stock = 10 μ½μ β†’ 1κ° μ°¨κ° κ°€λ¥ β…
...
μ‚¬μ©μ K: stock = 10 μ½μ β†’ 1κ° μ°¨κ° κ°€λ¥ β…

κ²°κ³Ό: μ¬κ³ κ°€ -5κ°κ°€ λ¨ (κ³Όλ‹¤ νλ§¤!)
```

**λ°μƒ ν™•λ¥ :** 
- μΈκΈ° μƒν’ κµ¬λ§¤/μμ•½ μ‹ ν•„μ μ‹λ‚λ¦¬μ¤
- μ: "ν•μ •ν μ΄λ™ν™” 100κ°" β†’ 1,000λ… λ™μ‹ μ£Όλ¬Έ

---

### 3. μΏ ν° μ¤‘λ³µ μ‚¬μ© π«

**νμΌ:** `CreateOrderUseCase.java`

**μ‹λ‚λ¦¬μ¤:**
- μ‚¬μ©μκ°€ μΏ ν° 1κ° λ³΄μ 
- λΈλΌμ°μ € 2κ° νƒ­μ—μ„ λ™μ‹μ— μ£Όλ¬Έ

**λ¬Έμ  μ½”λ“:**
```java
public Order execute(CreateOrderCommand command) {
    if (command.getUserCouponId() != null) {
        UserCoupon userCoupon = userCouponRepository.findById(userCouponId).orElseThrow();

        // π¨ λ¬Έμ  μ§€μ !
        if (userCoupon.getStatus() != UserCouponStatus.AVAILABLE) {
            throw new IllegalStateException("μ‚¬μ© λ¶κ°€");
        }

        userCoupon.use();  // status = USED
        userCouponRepository.save(userCoupon);
    }

    // μ£Όλ¬Έ μƒμ„±...
}
```

**μ™ λ¬Έμ ?**
```
νƒ­ A: status = AVAILABLE μ½μ β†’ μ‚¬μ© κ°€λ¥ β…
νƒ­ B: status = AVAILABLE μ½μ β†’ μ‚¬μ© κ°€λ¥ β… (Aκ°€ μ €μ¥ μ „!)

νƒ­ A: status = USED μ €μ¥
νƒ­ B: status = USED μ €μ¥

κ²°κ³Ό: μΏ ν° 1κ°λ΅ 2λ² ν• μΈλ°›μ!
```

**λ°μƒ ν™•λ¥ :**
- μλ„μ μΌλ΅ μ•…μ©ν•λ” κ²½μ° λ°μƒ

---

### 4. ν¬μΈνΈ λ™μ‹ μ‚¬μ© π’°

**νμΌ:** `UsePointUseCase.java`

**μ‹λ‚λ¦¬μ¤:**
- μ‚¬μ©μ ν¬μΈνΈ μ”μ•΅ 100
- λ™μ‹μ— 2κ° μ£Όλ¬Έ (κ°κ° 80 ν¬μΈνΈ μ‚¬μ© μ‹λ„)

**λ¬Έμ  μ½”λ“ (λ™μ‹μ„± μ μ–΄ μ—†λ‹¤λ©΄):**
```java
public void execute(UsePointCommand command) {
    Point point = pointRepository.findByUserId(userId).orElseThrow();

    // π¨ λ¬Έμ  μ§€μ !
    if (point.getBalance() < amount) {
        throw new IllegalArgumentException("ν¬μΈνΈ λ¶€μ΅±");
    }

    point.use(amount);  // balance -= amount
    pointRepository.save(point);
}
```

**μ™ λ¬Έμ ?**
```
μ£Όλ¬Έ A: balance = 100 μ½μ β†’ 80 ν¬μΈνΈ μ‚¬μ© κ°€λ¥ β…
μ£Όλ¬Έ B: balance = 100 μ½μ β†’ 80 ν¬μΈνΈ μ‚¬μ© κ°€λ¥ β… (Aκ°€ μ €μ¥ μ „!)

μ£Όλ¬Έ A: balance = 20 μ €μ¥
μ£Όλ¬Έ B: balance = 20 μ €μ¥ (λ®μ–΄μ”€!)

κ²°κ³Ό: 160 ν¬μΈνΈ μ‚¬μ©ν–μ§€λ§ μ”μ•΅ 20 (80 ν¬μΈνΈλ§ μ°¨κ°λ¨)
```

**λ°μƒ ν™•λ¥ :**
- ν¬μΈνΈ κ²°μ  μ‹μ¤ν…μ΄ μλ‹¤λ©΄ λ°μƒ κ°€λ¥
- μ: μ‚¬μ©μκ°€ μ—¬λ¬ νƒ­μ—μ„ λ™μ‹ μ£Όλ¬Έ

---

## λ™μ‹μ„± λ¬Έμ κ°€ μ—†λ” λ¶€λ¶„

### β… μƒν’ μ΅°ν
```javaμ—†μ
- μ—¬λ¬ μ‚¬μ©μκ°€ λ™μ‹μ— μ΅°νν•΄λ„ μ•
  // GetProductListUseCase.java
  public List<ProductListResponseDto> execute() {
  return productRepository.findAllWithTotalStockNative()...
  }
```
- **μ½κΈ°λ§** ν•λ―€λ΅ λ™μ‹μ„± λ¬Έμ  μ „

### β… μ¥λ°”κµ¬λ‹ μ΅°ν
```java
// GetCartItemsUseCase.java
public List<CartItemResponseDto> execute(GetCartItemsCommand command) {
    return cartItemRepository.findByCartId(cartId)...
}
```
- μ½κΈ° μ „μ©
- κ° μ‚¬μ©μμ μ¥λ°”κµ¬λ‹λ” λ…λ¦½μ 

---

## μ •λ¦¬

### λ™μ‹μ„± μ μ–΄κ°€ ν•„μ”ν• κ³³ (4κ³³)

| μ„μΉ | μ΄μ  | μ„ν—λ„ |
|------|------|----|
| **μΏ ν° λ°κΈ‰** | λ°κΈ‰ μλ‰ μ¦κ°€ | λ§¤μ° λ†’μ |
| **μ¬κ³  μ°¨κ°** | μ¬κ³  κ°μ† | λ§¤μ° λ†’μ |
| **μΏ ν° μ‚¬μ©** | μƒνƒ λ³€κ²½ | μ¤‘κ°„ |
| **ν¬μΈνΈ μ‚¬μ©** | μ”μ•΅ κ°μ† | λ†’μ |

### λ™μ‹μ„± μ μ–΄κ°€ λ¶ν•„μ”ν• κ³³

- μ΅°ν κΈ°λ¥ (GetProduct, GetCart λ“±)
- μ½κΈ° μ „μ© UseCase

---
