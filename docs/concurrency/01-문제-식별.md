# 01. ë™ì‹œì„± ë¬¸ì œ ì‹ë³„

---
### 1. ì¿ í° ì„ ì°©ìˆœ ë°œê¸‰ ğŸŸï¸


**ì‹œë‚˜ë¦¬ì˜¤:**
- ì¿ í° 100ê°œ ë‚¨ìŒ
- 200ëª…ì´ ë™ì‹œì— "ë°œê¸‰" ë²„íŠ¼ í´ë¦­

**ë¬¸ì œ ì½”ë“œ (ë™ì‹œì„± ì œì–´ ì—†ë‹¤ë©´):**
```java
public UserCoupon execute(IssueCouponCommand command) {
    Coupon coupon = couponRepository.findById(couponId).orElseThrow();

    // ğŸš¨ ë¬¸ì œ ì§€ì !
    if (coupon.getIssuedQuantity() >= coupon.getTotalQuantity()) {
        throw new IllegalStateException("ì¿ í° ì†Œì§„");
    }

    coupon.increaseIssuedQuantity();  // issuedQuantity++
    couponRepository.save(coupon);
}
```

**ì™œ ë¬¸ì œ?**
```
ì‚¬ìš©ì A: issuedQuantity = 99 ì½ìŒ â†’ ë°œê¸‰ ê°€ëŠ¥ âœ…
ì‚¬ìš©ì B: issuedQuantity = 99 ì½ìŒ â†’ ë°œê¸‰ ê°€ëŠ¥ âœ… (Aê°€ ì €ì¥ ì „!)

ì‚¬ìš©ì A: issuedQuantity = 100 ì €ì¥
ì‚¬ìš©ì B: issuedQuantity = 100 ì €ì¥ (ë®ì–´ì”€!)

ê²°ê³¼: 101ë²ˆì§¸ ì‚¬ìš©ìë„ ë°œê¸‰ ê°€ëŠ¥ (ì´ˆê³¼ ë°œê¸‰!)
```

**ë°œìƒ í™•ë¥ :** 
- ì„ ì°©ìˆœ ì´ë²¤íŠ¸ëŠ” ë™ì‹œ ì ‘ì† í­ë°œì  ì¦ê°€
- ì˜ˆ: "ìŠ¤íƒ€ë²…ìŠ¤ ë¬´ë£Œ ì¿ í° 100ê°œ" â†’ 10,000ëª… ë™ì‹œ ì ‘ì†

---

### 2. ì¬ê³  ë™ì‹œ ì°¨ê° ğŸ“¦

**íŒŒì¼:** `DecreaseStockUseCase.java`

**ì‹œë‚˜ë¦¬ì˜¤:**
- ìƒí’ˆ ì˜µì…˜ ì¬ê³  10ê°œ
- 20ëª…ì´ ë™ì‹œì— 1ê°œì”© ì£¼ë¬¸

**ë¬¸ì œ ì½”ë“œ:**
```java
public void execute(DecreaseStockCommand command) {
    ProductOption option = productOptionRepository.findById(optionId).orElseThrow();

    // ğŸš¨ ë¬¸ì œ ì§€ì !
    if (option.getStock() < quantity) {
        throw new IllegalStateException("ì¬ê³  ë¶€ì¡±");
    }

    option.decreaseStock(quantity);  // stock -= quantity
    productOptionRepository.save(option);
}
```

**ì™œ ë¬¸ì œ?**
```
ì‚¬ìš©ì A: stock = 10 ì½ìŒ â†’ 1ê°œ ì°¨ê° ê°€ëŠ¥ âœ…
ì‚¬ìš©ì B: stock = 10 ì½ìŒ â†’ 1ê°œ ì°¨ê° ê°€ëŠ¥ âœ…
...
ì‚¬ìš©ì K: stock = 10 ì½ìŒ â†’ 1ê°œ ì°¨ê° ê°€ëŠ¥ âœ…

ê²°ê³¼: ì¬ê³ ê°€ -5ê°œê°€ ë¨ (ê³¼ë‹¤ íŒë§¤!)
```

**ë°œìƒ í™•ë¥ :** 
- ì¸ê¸° ìƒí’ˆ êµ¬ë§¤/ì˜ˆì•½ ì‹œ í•„ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤
- ì˜ˆ: "í•œì •íŒ ìš´ë™í™” 100ê°œ" â†’ 1,000ëª… ë™ì‹œ ì£¼ë¬¸

---

### 3. ì¿ í° ì¤‘ë³µ ì‚¬ìš© ğŸ«

**íŒŒì¼:** `CreateOrderUseCase.java`

**ì‹œë‚˜ë¦¬ì˜¤:**
- ì‚¬ìš©ìê°€ ì¿ í° 1ê°œ ë³´ìœ 
- ë¸Œë¼ìš°ì € 2ê°œ íƒ­ì—ì„œ ë™ì‹œì— ì£¼ë¬¸

**ë¬¸ì œ ì½”ë“œ:**
```java
public Order execute(CreateOrderCommand command) {
    if (command.getUserCouponId() != null) {
        UserCoupon userCoupon = userCouponRepository.findById(userCouponId).orElseThrow();

        // ğŸš¨ ë¬¸ì œ ì§€ì !
        if (userCoupon.getStatus() != UserCouponStatus.AVAILABLE) {
            throw new IllegalStateException("ì‚¬ìš© ë¶ˆê°€");
        }

        userCoupon.use();  // status = USED
        userCouponRepository.save(userCoupon);
    }

    // ì£¼ë¬¸ ìƒì„±...
}
```

**ì™œ ë¬¸ì œ?**
```
íƒ­ A: status = AVAILABLE ì½ìŒ â†’ ì‚¬ìš© ê°€ëŠ¥ âœ…
íƒ­ B: status = AVAILABLE ì½ìŒ â†’ ì‚¬ìš© ê°€ëŠ¥ âœ… (Aê°€ ì €ì¥ ì „!)

íƒ­ A: status = USED ì €ì¥
íƒ­ B: status = USED ì €ì¥

ê²°ê³¼: ì¿ í° 1ê°œë¡œ 2ë²ˆ í• ì¸ë°›ìŒ!
```

**ë°œìƒ í™•ë¥ :**
- ì˜ë„ì ìœ¼ë¡œ ì•…ìš©í•˜ëŠ” ê²½ìš° ë°œìƒ

---

## ë™ì‹œì„± ë¬¸ì œê°€ ì—†ëŠ” ë¶€ë¶„

### âœ… ìƒí’ˆ ì¡°íšŒ
```java
// GetProductListUseCase.java
public List<ProductListResponseDto> execute() {
    return productRepository.findAllWithTotalStockNative()...
}
```
- **ì½ê¸°ë§Œ** í•˜ë¯€ë¡œ ë™ì‹œì„± ë¬¸ì œ ì—†ìŒ
- ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ì¡°íšŒí•´ë„ ì•ˆì „

### âœ… ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ
```java
// GetCartItemsUseCase.java
public List<CartItemResponseDto> execute(GetCartItemsCommand command) {
    return cartItemRepository.findByCartId(cartId)...
}
```
- ì½ê¸° ì „ìš©
- ê° ì‚¬ìš©ìì˜ ì¥ë°”êµ¬ë‹ˆëŠ” ë…ë¦½ì 

---

## ì •ë¦¬

### ë™ì‹œì„± ì œì–´ê°€ í•„ìš”í•œ ê³³ (3ê³³)

| ìœ„ì¹˜ | ì´ìœ  | ìœ„í—˜ë„ |
|------|------|----|
| **ì¿ í° ë°œê¸‰** | ë°œê¸‰ ìˆ˜ëŸ‰ ì¦ê°€ | ë§¤ìš° ë†’ìŒ |
| **ì¬ê³  ì°¨ê°** | ì¬ê³  ê°ì†Œ | ë§¤ìš° ë†’ìŒ |
| **ì¿ í° ì‚¬ìš©** | ìƒíƒœ ë³€ê²½ | ì¤‘ê°„ |

### ë™ì‹œì„± ì œì–´ê°€ ë¶ˆí•„ìš”í•œ ê³³

- ì¡°íšŒ ê¸°ëŠ¥ (GetProduct, GetCart ë“±)
- ì½ê¸° ì „ìš© UseCase

---
